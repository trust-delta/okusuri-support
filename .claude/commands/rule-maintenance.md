---
description: ルールファイル群の用語統一と整合性維持を実行
---

# ルールファイル整合性維持コマンド

docs/rules/内の全ルールファイルの用語統一と整合性を確保します。

## 実行内容

以下を順次実行し、不整合を発見・修正します：

1. **用語統一チェック**: 標準化された用語の使用状況確認
2. **閾値・基準値の整合性確認**: ファイル間での数値基準の一致確認  
3. **不整合箇所の自動修正**: 発見した問題を自動で修正
4. **修正レポートの出力**: 実施した修正内容をレポート

## チェック基準

### 標準化された用語

| 概念 | 標準形 | 使用禁止表記 |
|---------|---------------|-------------------|
| 作業計画書 | 作業計画書 | Work Plan、作業計画、workplan |
| サブエージェント | サブエージェント | sub-agent、sub agent、subagent |
| 品質チェック | 品質チェック | quality assurance、QA、品質保証 |
| Edit/Write/MultiEdit | Edit/Write/MultiEdit | 編集ツール、変更ツール |
| ユーザー承認 | ユーザー承認 | ユーザー確認、ユーザー同意 |
| 実装 | 実装 | コーディング、開発 |
| 調査 | 調査 | 分析、探索 |

### 重要な閾値統一

**ファイル数の閾値**
- 小規模：1-2ファイル（直接実装可能）
- 中規模：3-5ファイル（作業計画書推奨）  
- 大規模：6ファイル以上（作業計画書必須、ADR検討）
- 境界値：5ファイル以上で必ずユーザー承認を要求

**重複の閾値（Rule of Three）**
- 1回目：インラインで実装
- 2回目：将来の統合を意識してコメント記録
- 3回目：即座に共通化を実施（例外なし）

**テストカバレッジの閾値**
- 最低要求：70%（これ未満はコミット禁止）
- 目標カバレッジ：80%以上
- クリティカルパス：90%以上
- カバレッジ測定：`npm run test:coverage:fresh`で正確に計測

**エラー対応の閾値**
- 1回目：エラー内容を記録して修正
- 2回連続：根本原因分析（5 Whys）を実行
- 3回以上：設計見直しとユーザーエスカレーション

**コード品質の閾値**
- ファイル行数：300行（超えたら即座に分割）
- フィールド数：20個（超えたら責務で分割）
- オプショナル率：30%（超えたら必須/任意で型分離）
- ネスト深さ：3階層（超えたらフラット化）
- 型アサーション：3回以上で設計見直し

### 必須統一フレーズ

これらのフレーズは全ルールファイルで完全一致させること：

1. **「Edit/Write/MultiEditツールを使用する前に必ずユーザー承認を取得」**
2. **「ドキュメントレビューなしの実装開始は絶対禁止」**
3. **「すべての品質チェックがエラーなしで合格しない限り、作業は完了とみなされない」**
4. **「any型は完全に禁止 - unknown型と型ガードを使用」**
5. **「調査OK、実装STOP」**

### 品質チェック体系の統一

**Phase 1-3: 基本チェック**
- `npm run check` - Biome総合
- `npm run check:unused` - 未使用エクスポート
- `npm run build` - TypeScript

**Phase 4-6: テストと最終確認**
- `npm test` - テスト実行
- `npm run test:coverage:fresh` - カバレッジ確認（70%以上必須）
- `npm run check:all` - 統合チェック

## 修正ポリシー

### 自動修正の範囲
- 用語の表記統一（例：「タイプガード」→「型ガード」）
- 数値の統一（例：カバレッジ要求を70%に統一）
- フレーズの完全一致（上記5つの必須フレーズ）

### ユーザー確認が必要な修正
- ルールの内容変更を伴う修正
- 複数の解釈が可能な不整合
- アーキテクチャ設計に関わる変更

## 実行フロー

1. **全ルールファイルを読み込み**
2. **用語使用状況の調査**
3. **閾値・基準値の抽出と比較**
4. **不整合箇所をリスト化**
5. **自動修正可能な項目を修正**
6. **ユーザー確認が必要な項目を提示**
7. **修正完了レポートを出力**

このコマンドにより、ルールファイル群の一貫性と品質を維持し、rule-advisorが正確に動作する基盤を保持します。