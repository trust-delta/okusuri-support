---
name: decision-assistant
description: 技術的意思決定や重要な判断を構造化して記録する。背景・理由・代替案を整理し、将来の参照価値が高い決定記録を生成する。
---

# Decision作成アシスタント

## 目的

プロジェクトにおける重要な決定（技術選定、アーキテクチャ変更、機能設計、プロセス変更など）を構造化して記録し、将来の意思決定の根拠を明確に残します。

## いつ使うか

以下のような場面で、このスキルを呼び出してください：

- **技術的決定**: 「Next.js 15に移行すべきか検討したい」
- **アーキテクチャ変更**: 「認証方式をどうするか決めたい」
- **機能設計**: 「グループ削除機能をどう実装するか」
- **ライブラリ選定**: 「フォーム管理にreact-hook-formを使うか」
- **プロセス変更**: 「テストカバレッジの目標を変更したい」
- **設計判断**: 「この問題に対する解決策を記録したい」

## スキルが行うこと

1. **対話形式で情報収集**
   - 背景・問題点のヒアリング
   - 決定内容の明確化
   - 代替案の洗い出し

2. **構造化された記録の生成**
   - 既存の決定記録スタイルを分析
   - プロジェクト固有のフォーマットに準拠
   - 利点・欠点・代替案を明確に記載

3. **適切な配置と命名**
   - `.context/decisions/YYYY-MM-DD-[topic].md` に出力
   - 日付は自動取得（JST）
   - トピック名はkebab-caseで命名

## 実行時の動作

このスキルは以下の順序で実行されます：

### 1. 初期化フェーズ

1. **現在日時の取得**
   ```bash
   TZ='Asia/Tokyo' date '+%Y-%m-%d'
   ```
   - Bashツールを使用してJSTの日付を取得
   - ファイル名に使用（例: `2025-11-16`）

2. **テンプレートの読み込み**
   - `.context/decisions/templates/decision-template.md` を読み込み
   - 必須セクション、フォーマット、構造を把握

3. **既存決定記録の参照**
   - `.context/decisions/` から最新3-5件の決定記録を読み込み
   - スタイル、詳細度、記述パターンを学習

4. **矛盾チェック（該当する場合のみ）**
   - 新しい決定に関連する既存決定記録を検索
   - 矛盾する可能性がある決定を特定
   - 矛盾が見つかった場合、ユーザーに以下を確認：
     - 既存決定の変更・廃止が必要か
     - 新しい決定が既存決定の例外として扱われるか
     - 矛盾を解消する方法

**矛盾の例**:
- 既存: 「認証にClerkを使用」 → 新規: 「Convex Authに移行」（変更が必要）
- 既存: 「TypeScriptの厳格モードを使用」 → 新規: 「any型の使用を許可」（矛盾を指摘）

### 2. 対話フェーズ

ユーザーとの対話を通じて情報を収集（詳細は「対話フロー」セクション参照）

### 3. 生成フェーズ

収集した情報をテンプレートに基づいて構造化

#### ステータスの初期設定

決定記録のステータスは以下のルールで自動設定されます：

**デフォルト: `提案中`**
- これから検討・承認を受ける必要がある決定

**`承認済み` で作成する条件**:
- ユーザーが明示的に「決定した」「採用する」と述べた
- 実装が既に開始または完了している
- チーム内で合意が取れていることが明確

**`却下` で作成する条件**:
- 「この案は採用しない」という記録を残す場合
- 過去に検討したが却下された決定を記録する場合

**`廃止` で作成する条件**:
- 既存の決定を無効化する場合（ほぼ使用しない）

ステータスが不明確な場合、ユーザーに確認します。

#### 関連ドキュメントの自動提案

決定内容から関連しそうなドキュメントを自動的に検索・提案：

**検索対象**:
- `.context/` 配下のプロジェクトドキュメント（project.md, architecture.md, 仕様書など）
- 既存の決定記録（関連トピック）
- README、パッケージ設定ファイル

**提案ロジック**:
- 決定内容のキーワード（技術名、機能名）で検索
- 既存決定記録のタグ・カテゴリと照合
- 影響を受けるコンポーネント・モジュールから関連ファイルを特定

**例**:
- 「認証方式の変更」 → `.context/architecture.md`（認証フロー）、既存の認証関連決定
- 「UIライブラリ選定」 → `.context/project.md`（技術スタック）、`package.json`

### 4. バリデーションフェーズ

生成した決定記録が以下の基準を満たしているか確認：

- [ ] 必須セクションがすべて含まれているか
- [ ] 代替案が2つ以上記載されているか
- [ ] ファイル名がkebab-caseか（例: `nextjs-15-migration`）
- [ ] 日付がYYYY-MM-DD形式か
- [ ] 利点・欠点が具体的に記述されているか
- [ ] 技術的決定の場合、実装計画が含まれているか

### 5. 出力フェーズ

`.context/decisions/YYYY-MM-DD-[topic].md` に保存し、ユーザーに確認を促す

## トピック名の決定

決定内容から自動的にkebab-case形式で生成します：

**変換例**:
- 「Next.js 15への移行」 → `nextjs-15-migration`
- 「認証方式の変更」 → `authentication-method-change`
- 「フォーム管理ライブラリの選定」 → `form-library-selection`
- 「グループ削除機能の実装」 → `group-delete-implementation`
- 「pnpmへの移行」 → `migrate-to-pnpm`

**命名ルール**:
- 英数字と `-` のみ使用
- すべて小文字
- スペースは `-` に変換
- 日本語は英訳してkebab-case化
- 略語は小文字に統一（例: `nextjs`, `pnpm`）
- **動詞を含める**（例: `migrate-to-pnpm`, `adopt-react-hook-form`, `implement-group-delete`）
- **バージョン番号は含めない**（詳細は決定記録本文に記載）
  - ❌ `migrate-to-nextjs-15`
  - ✅ `migrate-to-nextjs`（本文で「Next.js 15への移行」と記載）
- **実装詳細ではなく決定の本質を表現**
  - ❌ `use-axios-for-http-requests`（実装詳細）
  - ✅ `http-client-selection`（決定の本質）
  - ❌ `add-loading-spinner-component`（実装詳細）
  - ✅ `loading-state-design`（決定の本質）

**動詞の使い分け**:
- `migrate-to-*`: 既存技術から新技術への移行
- `adopt-*`: 新しい技術・ライブラリの導入
- `implement-*`: 機能・パターンの実装方針
- `change-*`: 既存の方針・設定の変更
- `remove-*`: 既存機能・依存の削除
- `*-selection`: 複数の選択肢からの選定

トピック名が適切でない場合、ユーザーに確認を求めることができます。

## 対話フロー

### 対話の柔軟性

**重要**: 以下の5ステップは推奨フローですが、ユーザーが既に十分な情報を提供している場合は該当ステップをスキップできます。

例:
- ユーザーが「Next.js 15に移行します。理由は...、代替案として...を検討しましたが...」と詳細に説明した場合
  → ステップ2-4をスキップし、不足情報のみ確認
- ユーザーが「この技術選定を記録したい」とだけ言った場合
  → 全ステップを順番に実行

**判断基準**: ユーザーのメッセージから以下の情報が明確に読み取れる場合、該当ステップはスキップ可能
- 背景・問題点
- 決定内容
- 理由
- 代替案（最低2つ）
- リスク・影響範囲

### ステップ1: 背景のヒアリング

「どのような背景でこの決定が必要になりましたか？」
- 現状の問題点
- なぜ今決定する必要があるのか
- 関連する文脈

### ステップ2: 決定内容の確認

「具体的にどのような決定を行いますか？」
- 採用する解決策
- 主要な決定事項

### ステップ3: 理由の整理

「この決定を選択した理由を教えてください」
- なぜこの案が最適なのか
- 技術的根拠
- ビジネス的根拠

### ステップ4: 代替案の検討

「他に検討した代替案はありますか？」
- 少なくとも2-3の代替案
- 各案のメリット・デメリット
- 却下理由

### ステップ5: リスクと影響の確認

「実装上のリスクや影響範囲はありますか？」
- 技術的考慮事項
- 影響を受けるコンポーネント
- リスクと軽減策

## 生成される決定記録の構成

プロジェクトのテンプレート（`.context/decisions/templates/decision-template.md`）に準拠して決定記録を生成します。

**主要セクション**:
- タイトル、日付、ステータス、決定者
- 背景（問題点と文脈）
- 決定（採用する解決策）
- 理由（なぜこの決定を選択したか）
- 利点（✅ で列挙）
- 欠点と対応策（❌ デメリット → 対応策）
- 代替案（却下理由を明記）
- 実装計画（技術的決定の場合）
- 関連ドキュメント
- 承認テーブル
- 更新履歴

詳細な構造は `.context/decisions/templates/decision-template.md` を参照してください。

## 生成後の品質チェック

決定記録を生成した後、以下の項目をセルフチェックします：

### 必須項目チェックリスト

- [ ] **タイトル**: 決定内容を簡潔に表現しているか
- [ ] **日付**: YYYY-MM-DD形式で正しく記載されているか
- [ ] **ステータス**: `承認済み`/`提案中`/`却下`/`廃止`のいずれかが設定されているか
- [ ] **決定者**: 誰が決定したか明記されているか
- [ ] **背景**: 問題点と文脈が具体的に説明されているか
- [ ] **決定**: 採用する解決策が明確に記述されているか
- [ ] **理由**: なぜこの決定を選択したか、技術的/ビジネス的根拠が記載されているか
- [ ] **利点**: 最低2つ以上、✅ マークで列挙されているか
- [ ] **欠点と対応策**: 各デメリット（❌）に対応する対応策が記載されているか
- [ ] **代替案**: 最低2つ以上の代替案と却下理由が記載されているか

### 品質基準チェック

- [ ] **具体性**: 抽象的な表現ではなく、具体的な技術名・実装方法が記載されているか
- [ ] **将来の理解可能性**: 数ヶ月後に読んでも文脈を理解できるか
- [ ] **一貫性**: 既存の決定記録と矛盾していないか
- [ ] **完全性**: 他のチームメンバーが追加の質問なしで理解できるか

### 自動チェック項目

- [ ] ファイル名: `YYYY-MM-DD-[kebab-case-topic].md` 形式
- [ ] ファイルパス: `.context/decisions/` 直下
- [ ] 文字エンコーディング: UTF-8
- [ ] 改行コード: LF（Unix形式）

チェックで問題が見つかった場合、修正してから保存します。

## 既存決定記録の参照

このスキルは以下の既存決定記録を学習材料として参照します：

- `.context/decisions/2025-10-26-medication-statistics.md` (16KB) - 服薬統計機能の実装
- `.context/decisions/2025-10-26-prescription-management.md` (18KB) - 処方箋管理機能の導入
- `.context/decisions/2025-10-26-group-leave-delete.md` (14KB) - グループ脱退・削除機能
- `.context/decisions/2025-10-26-migrate-to-pnpm.md` (3.7KB) - pnpm移行
- `.context/decisions/2025-10-16-context-driven-development.md` (2.9KB) - コンテキスト駆動開発

これらのスタイル・構造・詳細度を参考に、一貫性のある決定記録を生成します。

## 関連コンテキスト

決定記録作成時に参照すべきプロジェクトドキュメント：

- `.context/project.md` - プロジェクト概要、技術スタック
- `.context/architecture.md` - アーキテクチャ全体像
- `.context/coding-style.md` - コーディング規約
- `.context/testing-strategy.md` - テスト戦略

## 注意事項

1. **既存決定の尊重**: 既存の決定記録と矛盾する場合は指摘する
2. **網羅的な検討**: 代替案は最低2つ以上提示する
3. **具体性**: 抽象的な記述ではなく、具体的な技術・実装に言及
4. **将来の自分への配慮**: 数ヶ月後に読んでも理解できる記述
5. **日本語**: すべて日本語で記述（コードを除く）

## 使用例

### 例1: 技術選定（最小限の情報から開始）

```
ユーザー: 「フォーム管理ライブラリをreact-hook-formにするか検討したい」

アシスタント:
フォーム管理ライブラリの選定について決定記録を作成します。

[初期化フェーズ]
- 現在日時を取得: 2025-11-16
- テンプレート読み込み: .context/decisions/templates/decision-template.md
- 既存記録参照: 最新3件の決定記録を分析

いくつか質問させてください。

1. 現在のフォーム管理でどのような課題がありますか？
2. react-hook-form以外に検討したライブラリはありますか？
   （例: Formik, React Final Form, TanStack Form）
3. プロジェクトで重視する要件は何ですか？
   （例: 型安全性、パフォーマンス、バンドルサイズ、学習コスト）

[対話を通じて情報収集]

[生成フェーズ]
決定記録を生成しています...

[バリデーションフェーズ]
- ✅ 必須セクション: 完備
- ✅ 代替案: 3つ記載（Formik, React Final Form, TanStack Form）
- ✅ ファイル名: form-library-selection (kebab-case)
- ✅ 具体性: 各ライブラリの技術的特徴を記載

決定記録を作成しました：
📄 .context/decisions/2025-11-16-form-library-selection.md

内容を確認して、必要に応じて修正してください。
```

### 例2: 詳細情報を含むリクエスト（スキップ対応）

```
ユーザー:
「認証をConvex Authに移行する決定を記録したい。
現在はClerk認証を使っているが、Convexとの統合が弱く、
追加のAPI呼び出しが必要になっている。Convex Authなら
Convex関数から直接認証情報にアクセスできる。
代替案としてSupabase AuthとAuth.jsも検討したが、
Convex Authの方がConvexエコシステムとの統合が優れている。」

アシスタント:
認証方式の変更について決定記録を作成します。

[初期化フェーズ]
- 現在日時を取得: 2025-11-16
- テンプレート読み込み: .context/decisions/templates/decision-template.md
- 既存記録参照: 認証関連の決定記録を優先的に参照

既に十分な情報をいただいているので、以下の点のみ確認させてください：

1. 移行にかかる工数の見積もりはありますか？
2. 既存ユーザーのデータ移行はどう対応しますか？
3. 移行のリスク（認証停止時間など）はありますか？

[不足情報のみ収集 - ステップ2-4はスキップ]

[生成フェーズ]
決定記録を生成しています...

[バリデーションフェーズ]
- ✅ 必須セクション: 完備
- ✅ 代替案: 3つ記載（Clerk継続, Supabase Auth, Auth.js）
- ✅ ファイル名: auth-migration-to-convex (kebab-case)
- ✅ 具体性: 各認証方式の統合方法を具体的に記載

決定記録を作成しました：
📄 .context/decisions/2025-11-16-auth-migration-to-convex.md

内容を確認して、必要に応じて修正してください。
```

### 例3: バリデーション失敗時の対応

```
ユーザー: 「UIコンポーネントライブラリの選定を記録したい」

アシスタント:
[初期化 → 対話 → 生成]

[バリデーションフェーズ]
- ✅ 必須セクション: 完備
- ❌ 代替案: 1つのみ（最低2つ必要）
- ✅ ファイル名: ui-component-library-selection
- ⚠️ 具体性: 一部抽象的な記述あり

バリデーションで問題が見つかりました。修正します：

1. 代替案を追加: Material-UI, Ant Design を追加
2. 具体性を向上: バンドルサイズの具体的な数値を記載

[再バリデーション]
- ✅ すべてのチェック項目をクリア

決定記録を作成しました：
📄 .context/decisions/2025-11-16-ui-component-library-selection.md
```

### 例4: 矛盾検出とステータス設定（既存決定の変更）

```
ユーザー: 「認証をConvex Authに移行することを決定しました」

アシスタント:
認証方式の変更について決定記録を作成します。

[初期化フェーズ]
- 現在日時を取得: 2025-11-16
- テンプレート読み込み: .context/decisions/templates/decision-template.md
- 既存記録参照: 最新3件の決定記録を分析

[矛盾チェックフェーズ]
⚠️ 既存決定との矛盾を検出しました：

- `.context/decisions/2025-09-15-authentication-with-clerk.md`
  - 決定: 「認証にClerkを使用」
  - ステータス: 承認済み

この決定は既存の認証方式を変更するものです。
以下のどちらを行いますか？

1. 既存決定（Clerk使用）を「廃止」に変更する
2. 両方の認証方式を併用する（新規決定を例外として扱う）

ユーザー: 「1. Clerkは廃止して、完全にConvex Authに移行します」

アシスタント:
了解しました。以下の対応を行います：
- 新規決定: Convex Auth採用（ステータス: 承認済み）
- 既存決定: `.context/decisions/2025-09-15-authentication-with-clerk.md` を「廃止」に更新

[ステータス設定]
「決定しました」と明言されているため、ステータスを「承認済み」に設定します。

[関連ドキュメント提案]
以下のドキュメントが関連すると思われます：
- `.context/architecture.md` - 認証フロー図の更新が必要
- `.context/decisions/2025-09-15-authentication-with-clerk.md` - 廃止する既存決定
- `convex/auth.config.ts` - 設定ファイル

これらを「関連ドキュメント」セクションに含めますか？

[生成フェーズ]
決定記録を生成しています...

[バリデーションフェーズ]
- ✅ すべてのチェック項目をクリア

決定記録を作成しました：
📄 .context/decisions/2025-11-16-migrate-to-convex-auth.md

また、既存決定を更新しました：
📝 .context/decisions/2025-09-15-authentication-with-clerk.md
  - ステータス: 承認済み → 廃止
  - 廃止理由: 2025-11-16-migrate-to-convex-auth.md により置き換え
```

## このスキルの利点

✅ **意思決定の質向上**: 代替案検討を強制し、見落としを防ぐ
✅ **知識の蓄積**: なぜその決定をしたか、将来の自分・チームが理解できる
✅ **一貫性**: プロジェクト全体で統一されたフォーマット
✅ **効率化**: 18KBの詳細な決定記録も対話形式で作成可能
✅ **柔軟な対話**: ユーザーの情報量に応じて質問をスキップ、無駄な往復を削減
✅ **品質保証**: 自動バリデーションで必須項目の漏れを防ぐ
✅ **正確な日時**: Bashツールでシステム日時を取得、手入力ミスを防止
✅ **命名の一貫性**: kebab-case変換ルールでファイル名の統一
✅ **矛盾の早期検出**: 既存決定との矛盾を自動検出、意思決定の整合性を保つ
✅ **適切なステータス管理**: 文脈から適切な初期ステータスを自動設定
✅ **関連情報の提示**: 決定内容から関連ドキュメントを自動提案、情報の網羅性向上
✅ **実務的な命名**: 動詞を含めた命名で、ファイル名だけで決定の性質を把握可能

## プロジェクト固有のルール（CLAUDE.md参照）

- `.context/decisions/` に記載された決定記録を尊重すること
- 決定記録で決定された技術選定や設計方針に従うこと
- 新たな技術的決定を行う場合は、決定記録として記録することを提案すること
