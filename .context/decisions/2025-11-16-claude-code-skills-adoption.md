# 決定記録: Claude Code スキル機能の活用

**日付**: 2025年11月16日
**ステータス**: 承認済み
**決定者**: 開発者

---

## 背景

本プロジェクトでは、コンテキスト駆動開発を採用し、`.context/` ディレクトリに重要なドキュメント（決定記録、仕様書、手順書など）を集約している。しかし、ドキュメント作成において以下の課題が顕在化してきた：

### 現状の問題点

#### 1. ワークフローにおける非効率性

手動でのドキュメント作成は以下の課題がある：
- テンプレートのコピー&ペーストに時間がかかる
- セクションの記入漏れが発生しやすい
- フォーマットの一貫性を保つのが困難

#### 2. 決定事項の記録漏れリスク

主観の介在余地があり、以下のリスクが存在する：
- 代替案の検討が不十分になる可能性
- 「なぜこの決定をしたか」の記録が曖昧になる
- 将来の自分・チームが意思決定の背景を理解できない

#### 3. 持続可能なAI協働の必要性

プロジェクトが成長するにつれて：
- 決定記録の作成頻度が増加
- より包括的で詳細な記録が求められる
- 手動管理ではスケールしない

### なぜ今決定する必要があるのか

- decision-assistantスキルを作成したばかりで、実証実験の好機
- プロジェクトが成長段階にあり、早期にワークフローを確立したい
- 知識の蓄積を確実にするための仕組みが必要

---

## 決定

### Claude Code スキル機能を活用する

以下の方針でスキル機能を導入する：

1. **第一段階: decision-assistantスキルの活用**
   - 決定記録の作成を対話形式で支援
   - プロジェクトのテンプレート（`.context/decisions/templates/decision-template.md`）に準拠
   - 既存の決定記録のスタイルを学習

2. **成果次第で展開**
   - 他のスキル（仕様書作成、コード品質チェックなど）も積極的に導入
   - コンテキスト管理や開発を効率化
   - プロジェクト全域への展開も視野

3. **ワークフローとしての確立**
   - このプロジェクトの標準ワークフローとして定着
   - CLAUDE.mdに記載し、一貫した運用を実現

---

## 理由

### 1. スキルの特性がユースケースにマッチ

#### プログレッシブディスクロージャー
- 必要な時だけコンテキストを展開
- 通常の開発フローを妨げない
- ヒアリング形式で情報を段階的に収集

#### 知識とツールのパッケージング
- プロジェクト固有のテンプレートを埋め込み可能
- 既存の決定記録スタイルを学習材料として参照
- 一貫性のあるドキュメント生成

### 2. サブエージェントとの使い分け

サブエージェントは以下の用途に適している：
- **独立したコンテキストウィンドウ**: メインの会話を汚さない
- **タスクの並行実行**: 複数ファイルの同時解析など
- **試行錯誤の分離**: 探索的なタスク

一方、スキルは以下に適している：
- **会話からの自然な流れ**: 対話形式で情報を収集
- **実装後の記録**: 決定事項を会話の文脈で記載
- **構造化された出力**: テンプレートに準拠

今回のユースケース（決定記録の作成）は、会話の流れを重視するためスキルが最適。

### 3. 手動管理の限界

手動でのテンプレート使用には以下の問題がある：
- 主観の介在余地が大きい
- 時間と手間がかかる
- セクションの記入漏れが発生しやすい

スキルによる対話形式なら、漏れを防ぎながら効率的に記録を作成できる。

### 4. 外部ツールとの比較

Notion、Confluenceなどの外部ツールは以下の理由で採用しない：
- **外部依存の回避**: コードベース内で完結したい
- **バージョン管理**: Gitで決定記録をバージョン管理できる
- **AI協働の文脈**: Claude Codeとの統合が容易

---

## 利点

✅ **作成時間の削減**: 対話形式で効率的にドキュメント作成
✅ **記録の網羅性向上**: ヒアリング形式で記入漏れを防止
✅ **一貫性の保持**: プロジェクト固有のテンプレートに自動準拠
✅ **知識の蓄積**: 代替案・理由を確実に記録、将来の参照価値が高い
✅ **スケーラビリティ**: 記録の頻度が増えても対応可能
✅ **ワークフローへの統合**: 自然な会話の流れで記録作成
✅ **コードベース内完結**: 外部ツールへの依存なし

---

## 欠点と対応策

❌ **ヒアリングへの回答コスト**: 対話形式のため、質問に答える手間が発生
  → **対応**: ヒアリング項目を最小限に絞る。慣れれば回答は迅速化する見込み

❌ **大量記録の検索コスト**: 決定記録が大量に蓄積すると検索が困難
  → **対応**: 決定記録検索のための仕組み（スキル、サブエージェント、スクリプト）を将来的に用意

❌ **スキル保守コスト**: スキル自体のメンテナンスが必要
  → **対応**: スキルは`.claude/skills/`内で管理され、Gitでバージョン管理。テンプレート変更時の更新は最小限

❌ **Claude Codeへの依存**: Claude Codeのバージョンアップで影響を受ける可能性
  → **対応**: 生成された決定記録は`.context/`に保存され、ツールに依存しない。スキル機能が廃止されても、既存記録は影響を受けない

---

## 代替案

### 代替案1: 手動でテンプレートを使用

**概要**: `.context/decisions/templates/decision-template.md`を手動でコピーし、記入する

**メリット**:
- シンプル
- 追加ツール不要
- 学習コストなし

**デメリット**:
- 主観の介在余地が大きい
- 時間と手間がかかる
- セクションの記入漏れが発生しやすい
- 一貫性の保持が困難

**却下理由**: 手動管理では記録の網羅性と一貫性を担保できない。知識の蓄積を確実にする仕組みが必要。

### 代替案2: サブエージェントで実装

**概要**: 決定記録作成をサブエージェントに委任

**メリット**:
- コンテキスト分離
- 並行実行可能
- 試行錯誤を分離

**デメリット**:
- サブエージェントは「タスクの並行実行と試行錯誤の分離」が主用途
- 会話からの自然な流れを活かせない
- 実装後の決定事項記載に不適

**却下理由**: サブエージェントの特性と、決定記録作成のユースケースがミスマッチ。対話形式で情報を収集するスキルの方が適している。

### 代替案3: 外部ツール（Notion、Confluence等）

**概要**: 外部のドキュメント管理ツールを使用

**メリット**:
- UI/UX が洗練されている
- 検索機能が充実
- コラボレーション機能

**デメリット**:
- 外部依存が発生
- バージョン管理がGitと別になる
- AI協働の文脈から離れる
- コストが発生する可能性

**却下理由**: コードベース内で完結したい。決定記録をGitで管理し、AIとの協働を円滑にするため。

---

## 実装計画

### フェーズ1: decision-assistantスキルの運用開始

#### タスク
- [x] decision-assistantスキルの作成
- [x] プロジェクトテンプレートへの準拠確認
- [x] 既存決定記録の参照設定
- [x] この決定記録の作成（実証実験）

### フェーズ2: 運用の定着と評価

#### タスク
- [ ] 3件以上の決定記録をスキルで作成
- [ ] 記録の網羅性を評価（セクションの記入漏れチェック）
- [ ] 作成時間を測定（手動との比較）
- [ ] ヒアリング項目の適切性を評価

#### 成功基準
- 決定記録の記入漏れがゼロ
- 手動作成と比較して時間短縮を実感
- フォーマットの一貫性が保たれている

### フェーズ3: 他スキルへの展開検討

#### 候補スキル
- **仕様書作成アシスタント**: 機能仕様書を対話形式で作成
- **コード品質チェッカー**: プロジェクト固有の規約をチェック
- **Runbook作成アシスタント**: 作業手順書を生成

#### 判断基準
- decision-assistantの成果が良好であること
- プロジェクトの成長に伴いニーズが明確であること

---

## 技術的考慮事項

### 1. スキルの配置

スキルは`.claude/skills/`に配置：
```
.claude/skills/decision-assistant/
├── SKILL.md
└── (将来的にcontextディレクトリを追加可能)
```

### 2. テンプレートとの連携

スキルは以下を参照：
- `.context/decisions/templates/decision-template.md` (プロジェクトテンプレート)
- `.context/decisions/*.md` (既存決定記録5件)

### 3. 出力先

生成された決定記録は以下に配置：
```
.context/decisions/YYYY-MM-DD-[topic].md
```

ファイル名形式：
- 日付: YYYY-MM-DD (JST)
- トピック: kebab-case

### 4. バージョン管理

- スキル自体はGitで管理
- 生成された決定記録もGitで管理
- ツールに依存せず、決定記録は永続的に保持

---

## 影響範囲

### 影響を受けるワークフロー

- **決定記録作成**: 手動 → スキル活用に変更
- **技術的決定プロセス**: 対話形式で代替案を検討する習慣が定着
- **ドキュメント整備**: より網羅的で詳細な記録が蓄積

### 影響を受けるステークホルダー

- **開発者**: 決定記録作成の手間が軽減、質が向上
- **将来のチームメンバー**: 詳細な意思決定の背景を理解可能
- **AI（Claude）**: プロジェクト固有の決定記録を参照し、より適切な提案が可能

---

## リスクと軽減策

| リスク | 発生確率 | 影響度 | 軽減策 |
|--------|----------|--------|--------|
| 大量記録の検索困難 | 中 | 中 | 決定記録検索の仕組み（スキル/スクリプト）を将来的に導入 |
| ヒアリング回答の負担 | 低 | 低 | ヒアリング項目を最小限に絞る。慣れにより負担は軽減 |
| スキル保守コスト | 低 | 低 | Git管理で変更履歴を追跡。テンプレート変更時のみ更新 |
| Claude Codeバージョンアップ | 低 | 中 | 決定記録は`.context/`に保存され、ツール非依存。影響は限定的 |

---

## 成功基準

- [ ] **記録の網羅性**: 決定事項の記入漏れがない（代替案、理由、リスクなど）
- [ ] **一貫性**: プロジェクトテンプレートに100%準拠
- [ ] **効率性**: 手動作成と比較して時間短縮を実感
- [ ] **品質**: 将来読み返して意思決定の背景を理解できる

### 致命的な機能不全の場合

- スキルの使用を再検討
- 手動でのテンプレート使用に戻す
- 問題点を分析し、代替策を検討

---

## 関連ドキュメント

- [コンテキスト駆動開発の導入決定記録](./2025-10-16-context-driven-development.md)
- [プロジェクト概要](../project.md)
- [CLAUDE.md (プロジェクトルール)](../../CLAUDE.md)
- [決定記録テンプレート](./templates/decision-template.md)

---

## 承認

| 役割 | 名前 | 日付 |
|------|------|------|
| 提案者 | Claude (AI) | 2025-11-16 |
| レビュー | 開発者 | 2025-11-16 |
| 承認者 | 開発者 | 2025-11-16 |

---

## 実装状況

1. ✅ decision-assistantスキルの作成
2. ✅ プロジェクトテンプレートへの準拠確認
3. ✅ 既存決定記録の参照設定
4. ✅ 決定記録作成（このドキュメント）
5. ⏳ 運用の定着と評価
6. ⏳ 他スキルへの展開検討

---

## 更新履歴

- 2025-11-16: 初版作成（decision-assistantスキルの実証実験として作成）
