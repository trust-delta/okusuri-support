# [機能名] 機能仕様

**最終更新**: [YYYY年MM月DD日]

## 概要
[この機能の目的と価値提案を2-3文で記述]

---

## ユースケース

### 主要シナリオ

**シナリオ1: [タイトル]**
1. [ステップ1]
2. [ステップ2]
3. [ステップ3]

**シナリオ2: [タイトル]**
1. [ステップ1]
2. [ステップ2]
3. [ステップ3]

---

## 機能要件

### [カテゴリ1]

#### [機能1-1]
- **説明**: [機能の詳細説明]
- **優先度**: [高/中/低]
- **実装状況**: [完了/進行中/未実装]

#### [機能1-2]
- **説明**: [機能の詳細説明]
- **優先度**: [高/中/低]
- **実装状況**: [完了/進行中/未実装]

### [カテゴリ2]

#### [機能2-1]
- **説明**: [機能の詳細説明]
- **優先度**: [高/中/低]
- **実装状況**: [完了/進行中/未実装]

---

## データモデル

### テーブル定義

#### `[テーブル名1]`
```typescript
{
  _id: Id<"[テーブル名]">,
  [field1]: [type], // [説明]
  [field2]: [type], // [説明]
  createdAt: number,
  updatedAt?: number,
}
```

**インデックス**:
- `by_[field]`: `[field]` による検索用

#### `[テーブル名2]`
```typescript
{
  _id: Id<"[テーブル名]">,
  [field1]: [type], // [説明]
}
```

### ER図
```
[Entity1] 1----N [Entity2]
    |
    |
    N
[Entity3]
```

---

## ビジネスルール

### [ルールカテゴリ1]

1. **[ルール名]**: [ルールの説明]
   - 例: [具体例]

2. **[ルール名]**: [ルールの説明]
   - 例: [具体例]

### [ルールカテゴリ2]

1. **[ルール名]**: [ルールの説明]

---

## 権限設計（RBAC）

### ロール定義

| ロール | 説明 | 主な権限 |
|--------|------|----------|
| [role1] | [説明] | [権限の概要] |
| [role2] | [説明] | [権限の概要] |

### 権限マトリクス

| 操作 | [role1] | [role2] | 備考 |
|------|---------|---------|------|
| [操作1] | ✅ | ❌ | [条件があれば] |
| [操作2] | ✅ | ✅ | [条件があれば] |
| [操作3] | ❌ | ✅ | [条件があれば] |

---

## API設計

### Queries（データ取得）

#### `[関数名]`
- **用途**: [説明]
- **認証**: [必須/任意]
- **引数**: `{ [arg]: [type] }`
- **戻り値**: `[returnType]`

### Mutations（データ更新）

#### `[関数名]`
- **用途**: [説明]
- **認証**: 必須
- **引数**: `{ [arg]: [type] }`
- **戻り値**: `[returnType]`
- **副作用**: [テーブル名]: [作成/更新/削除]

### Actions（外部連携）

#### `[関数名]`
- **用途**: [説明]
- **認証**: 必須
- **引数**: `{ [arg]: [type] }`
- **戻り値**: `[returnType]`
- **外部依存**: [外部サービス名]

詳細: [API仕様書](../api/[feature]-api.md)

---

## UI/UX要件

### 画面構成

#### [画面名1]
- **パス**: `/[path]`
- **目的**: [画面の目的]
- **主要コンポーネント**:
  - `[ComponentName]`: [説明]

#### [画面名2]
- **パス**: `/[path]`
- **目的**: [画面の目的]

### インタラクション

1. **[操作名]**:
   - トリガー: [ボタンクリック/フォーム送信/etc]
   - フィードバック: [Toast通知/画面遷移/etc]

---

## バリデーション

### フロントエンド

```typescript
const schema = z.object({
  [field]: z.string()
    .min([min], "[エラーメッセージ]")
    .max([max], "[エラーメッセージ]"),
});
```

### バックエンド

```typescript
// convex/[feature]/mutations.ts
if (!args.[field]) {
  throw new Error("[エラーメッセージ]");
}
```

---

## エラーハンドリング

| エラータイプ | メッセージ | 発生条件 | ユーザーアクション |
|--------------|-----------|----------|-------------------|
| 認証エラー | "[メッセージ]" | [条件] | [推奨アクション] |
| バリデーションエラー | "[メッセージ]" | [条件] | [推奨アクション] |
| ビジネスルールエラー | "[メッセージ]" | [条件] | [推奨アクション] |

---

## セキュリティ要件

### 認証
- [認証方式]: [詳細]

### 認可
- [認可ルール1]
- [認可ルール2]

### データ保護
- [保護対象データ]: [保護方法]

---

## パフォーマンス要件

- **レスポンスタイム**: [目標値]
- **同時接続数**: [目標値]
- **データ量**: [想定規模]

### 最適化戦略
1. [最適化手法1]
2. [最適化手法2]

---

## テスト要件

### ユニットテスト
- [ ] [テストケース1]
- [ ] [テストケース2]

### 統合テスト
- [ ] [テストケース1]
- [ ] [テストケース2]

### E2Eテスト
- [ ] [シナリオ1]
- [ ] [シナリオ2]

テスト実装: `app/_shared/features/[feature]/__tests__/`

---

## 依存関係

### 内部依存
- [機能名]: [依存内容]

### 外部依存
- [ライブラリ/サービス名]: [用途]

---

## マイルストーン

### Phase 1: MVP（完了/進行中/未着手）
- [x] [タスク1]
- [x] [タスク2]
- [ ] [タスク3]

### Phase 2: 機能拡張（未着手）
- [ ] [タスク1]
- [ ] [タスク2]

### Phase 3: 最適化（未着手）
- [ ] [タスク1]

---

## 既知の課題

| 課題 | 優先度 | 対応予定 | 備考 |
|------|--------|----------|------|
| [課題1] | [高/中/低] | [Phase X] | [詳細] |

---

## 関連ドキュメント

- [API仕様](../api/[feature]-api.md)
- [API設計規約](../api/conventions.md)
- [プロジェクト概要](../../project.md)
- [アーキテクチャ](../../architecture.md)
- [テスト戦略](../../testing-strategy.md)
