# モバイルナビゲーション機能仕様

**最終更新**: 2026年01月12日

## 概要

モバイル端末向けのナビゲーションUIを提供する機能。画面下部の固定ナビゲーションバー（ボトムナビ）と、追加メニュー用のサイドシートを組み合わせて、主要機能への素早いアクセスを実現する。

---

## ユースケース

### 主要シナリオ

**シナリオ1: 主要画面への移動**
1. ユーザーがボトムナビのアイコンをタップ
2. 対応する画面（ホーム/履歴/処方箋/残量）に遷移
3. 現在のグループIDがクエリパラメータとして引き継がれる

**シナリオ2: その他メニューへのアクセス**
1. ユーザーが「その他」ボタンをタップ
2. サイドシートが右からスライドイン
3. 統計/グループ/設定のメニューが表示される
4. メニュー項目をタップで該当画面に遷移

---

## 機能要件

### ボトムナビゲーション（BottomNavigation）

#### ナビゲーション項目
- **説明**: 主要4画面（ホーム、履歴、処方箋、残量）へのリンクを表示
- **優先度**: 高
- **実装状況**: 完了

#### アクティブ状態表示
- **説明**: 現在の画面に対応するアイコンをハイライト表示
- **優先度**: 高
- **実装状況**: 完了

#### アクセシビリティ対応
- **説明**: `aria-current="page"`でアクティブ状態を支援技術に伝達、メニューボタンに`aria-label`を設定
- **優先度**: 中
- **実装状況**: 完了

### モバイルメニュー（MobileMenu）

#### サイドシート表示
- **説明**: Sheet コンポーネントを使用した右スライドメニュー
- **優先度**: 高
- **実装状況**: 完了

#### メニュー項目
- **説明**: 統計、グループ、設定の3項目をアイコン・説明文付きで表示
- **優先度**: 高
- **実装状況**: 完了

---

## コンポーネント構成

### ファイル構成

```
app/(private)/_components/
├── MobileNavigation.tsx    # 統合コンポーネント（状態管理）
├── BottomNavigation.tsx    # ボトムナビゲーションバー
└── MobileMenu.tsx          # サイドメニューシート
```

### コンポーネント階層

```
MobileNavigation
├── BottomNavigation
│   ├── Link × 4（ホーム/履歴/処方箋/残量）
│   └── Button（その他メニュー）
└── MobileMenu
    └── Sheet
        └── Link × 3（統計/グループ/設定）
```

### Props定義

#### MobileNavigation
- Props: なし
- 状態: `menuOpen: boolean` - サイドメニューの開閉状態

#### BottomNavigation
```typescript
interface Props {
  onMenuClick: () => void; // その他ボタンクリック時のコールバック
}
```

#### MobileMenu
```typescript
interface Props {
  open: boolean;                    // メニューの開閉状態
  onOpenChange: (open: boolean) => void; // 状態変更時のコールバック
}
```

---

## UI/UX要件

### レスポンシブ対応
- **表示条件**: `md` ブレークポイント未満（768px未満）でのみ表示
- **非表示**: デスクトップでは既存のサイドバーを使用

### ナビゲーション項目

| 位置 | アイコン | ラベル | 遷移先 |
|------|----------|--------|--------|
| ボトムナビ1 | Home | ホーム | /dashboard |
| ボトムナビ2 | History | 履歴 | /history |
| ボトムナビ3 | Pill | 処方箋 | /prescriptions |
| ボトムナビ4 | Package | 残量 | /inventory |
| ボトムナビ5 | Menu | その他 | サイドメニュー開 |
| サイドメニュー1 | BarChart3 | 統計 | /statistics |
| サイドメニュー2 | Users | グループ | /group |
| サイドメニュー3 | Settings | 設定 | /settings |

### グループID引き継ぎ
- 現在のURLの`groupId`クエリパラメータを全てのリンクに引き継ぐ
- `encodeURIComponent`でURLエンコードを行う

---

## アクセシビリティ要件

### ARIA属性

| 要素 | 属性 | 値 | 説明 |
|------|------|-----|------|
| アクティブなリンク | `aria-current` | `"page"` | 現在のページを示す |
| その他ボタン | `aria-label` | `"その他のメニューを開く"` | ボタンの目的を説明 |

### キーボード操作
- Tab: フォーカス移動
- Enter/Space: リンク/ボタンの実行
- Escape: サイドメニューを閉じる（Sheet標準機能）

---

## 依存関係

### 内部依存
- `@/lib/utils`: `cn` 関数（クラス名結合）
- `@/components/ui/sheet`: Sheet, SheetContent, SheetHeader, SheetTitle, SheetClose

### 外部依存
- `lucide-react`: アイコンコンポーネント
- `next/link`: クライアントサイドナビゲーション
- `next/navigation`: `usePathname`, `useSearchParams`

---

## テスト要件

### ユニットテスト
- [ ] アクティブ状態の判定が正しく動作する
- [ ] groupIdが正しくエンコードされる
- [ ] aria属性が正しく設定される

### 統合テスト
- [ ] メニュー開閉の状態管理が正しく動作する
- [ ] リンククリックで正しい画面に遷移する

### E2Eテスト
- [ ] モバイルビューでボトムナビが表示される
- [ ] デスクトップビューでボトムナビが非表示になる
- [ ] その他ボタンタップでサイドメニューが開く

---

## 関連ドキュメント

- [プロジェクト概要](../../project.md)
- [アーキテクチャ](../../architecture.md)
